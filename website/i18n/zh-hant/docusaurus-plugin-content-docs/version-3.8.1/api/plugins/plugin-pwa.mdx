---
sidebar_position: 9
slug: /api/plugins/@docusaurus/plugin-pwa
---

# ğŸ“¦ plugin-pwa

Docusaurus æ’ä»¶ï¼Œä½¿ç”¨ [Workbox](https://developers.google.com/web/tools/workbox) æ·»åŠ  PWA æ”¯æ´ã€‚æ­¤æ’ä»¶åƒ…åœ¨ç”Ÿç”¢ç’°å¢ƒæ§‹å»ºæ™‚ç”Ÿæˆ [Service Worker](https://developers.google.com/web/fundamentals/primers/service-workers)ï¼Œè®“æ‚¨èƒ½å‰µå»ºå…·å‚™é›¢ç·šèˆ‡å®‰è£åŠŸèƒ½çš„å®Œæ•´ PWA åˆè¦æ–‡æª”ç«™é»ã€‚

## å®‰è£ {#installation}

```bash npm2yarn
npm install --save @docusaurus/plugin-pwa
```

## é…ç½® {#configuration}

åœ¨ `./static/manifest.json` å‰µå»º [PWA æ¸…å–®æ–‡ä»¶](https://web.dev/add-manifest/)ã€‚

ä¿®æ”¹ `docusaurus.config.js` åŠ å…¥æœ€å°åŒ– PWA é…ç½®ï¼Œä¾‹å¦‚ï¼š

```js title="docusaurus.config.js"
export default {
  plugins: [
    [
      '@docusaurus/plugin-pwa',
      {
        debug: true,
        offlineModeActivationStrategies: [
          'appInstalled',
          'standalone',
          'queryString',
        ],
        pwaHead: [
          {
            tagName: 'link',
            rel: 'icon',
            href: '/img/docusaurus.png',
          },
          {
            tagName: 'link',
            rel: 'manifest',
            href: '/manifest.json', // your PWA manifest
          },
          {
            tagName: 'meta',
            name: 'theme-color',
            content: 'rgb(37, 194, 160)',
          },
        ],
      },
    ],
  ],
};
```

## æ¼¸é€²å¼ç¶²è·¯æ‡‰ç”¨ {#progressive-web-app}

åƒ…å®‰è£ service worker ä¸¦ä¸è¶³ä»¥è®“æ‚¨çš„æ‡‰ç”¨æˆç‚º PWAã€‚æ‚¨è‡³å°‘éœ€è¦åŒ…å« [Web æ‡‰ç”¨æ¸…å–®](https://developer.mozilla.org/en-US/docs/Web/Manifest) ä¸¦åœ¨ `<head>` ä¸­æ·»åŠ æ­£ç¢ºæ¨™ç±¤ï¼ˆåƒè¦‹ [é¸é … > pwaHead](#pwahead)ï¼‰ã€‚

éƒ¨ç½²å¾Œï¼Œæ‚¨å¯ä½¿ç”¨ [Lighthouse](https://developers.google.com/web/tools/lighthouse) å°ç«™é»é€²è¡Œå¯©æ ¸ã€‚

æ›´å®Œæ•´çš„ PWA è¦æ±‚æ¸…å–®ï¼Œè«‹åƒè€ƒ [PWA æª¢æŸ¥è¡¨](https://developers.google.com/web/progressive-web-apps/checklist)

## æ‡‰ç”¨ç¨‹å¼å®‰è£æ”¯æ´ {#app-installation-support}

è‹¥ç€è¦½å™¨æ”¯æ´ï¼Œæ‚¨å¯å°‡ Docusaurus ç«™é»ä½œç‚ºæ‡‰ç”¨ç¨‹å¼å®‰è£ã€‚

![æ‡‰ç”¨å®‰è£æµç¨‹ç•«é¢éŒ„è£½ã€‚ç€è¦½å™¨ç¶²å€åˆ—å‡ºç¾æŒ‰éˆ•ï¼Œé»æ“Šå¾Œé¡¯ç¤ºã€Œå®‰è£æ­¤æ‡‰ç”¨ç¨‹å¼ï¼Ÿã€å°è©±æ¡†ã€‚é»æ“Šã€Œå®‰è£ã€æŒ‰éˆ•å¾Œï¼Œä½œæ¥­ç³»çµ±æœƒé–‹å•Ÿæ–°æ‡‰ç”¨ç¨‹å¼ä¸¦è¼‰å…¥ Docusaurus é¦–é ã€‚](/img/pwa_install.gif)

:::note

æ‡‰ç”¨å®‰è£éœ€ HTTPS å”å®šèˆ‡æœ‰æ•ˆæ¸…å–®æ–‡ä»¶ã€‚

:::

## é›¢ç·šæ¨¡å¼ï¼ˆé ç·©å­˜ï¼‰ {#offline-mode-precaching}

æˆ‘å€‘é€é service-worker é ç·©å­˜æ©Ÿåˆ¶ï¼Œè®“ä½¿ç”¨è€…èƒ½é›¢ç·šç€è¦½ Docusaurus ç«™é»ã€‚

[workbox-precaching](https://developers.google.com/web/tools/workbox/modules/workbox-precaching) é é¢è§£é‡‹æ ¸å¿ƒæ¦‚å¿µï¼š

> Service worker çš„ç‰¹æ€§ä¹‹ä¸€æ˜¯åœ¨å®‰è£æ™‚èƒ½å°‡æ–‡ä»¶çµ„ä¿å­˜è‡³ç·©å­˜ã€‚æ­¤éç¨‹å¸¸ç¨±ç‚ºã€Œé ç·©å­˜ã€ï¼Œå› å…§å®¹åœ¨ service worker å•Ÿç”¨å‰å³è¢«ç·©å­˜ã€‚
>
> ä¸»è¦å„ªå‹¢åœ¨æ–¼é–‹ç™¼è€…å¯å®Œå…¨æ§åˆ¶ç·©å­˜ï¼Œèƒ½æ±ºå®šæ–‡ä»¶ç·©å­˜æ™‚æ©Ÿèˆ‡æœŸé™ï¼Œä¸¦ç›´æ¥æä¾›ç€è¦½å™¨ä½¿ç”¨è€Œç„¡éœ€ç¶²è·¯è«‹æ±‚ï¼Œå¾è€Œå‰µå»ºå¯é›¢ç·šé‹ä½œçš„ç¶²é æ‡‰ç”¨ã€‚
>
> Workbox é€éç°¡åŒ– API èˆ‡ç¢ºä¿è³‡æºé«˜æ•ˆä¸‹è¼‰ï¼Œå¤§å¹…é™ä½äº†é ç·©å­˜çš„å¯¦ä½œé–€æª»ã€‚

é è¨­æƒ…æ³ä¸‹ï¼Œç•¶ç«™é»ä½œç‚ºæ‡‰ç”¨å®‰è£æ™‚æœƒå•Ÿç”¨é›¢ç·šæ¨¡å¼ã€‚è©³è¦‹ `offlineModeActivationStrategies` é¸é …èªªæ˜ã€‚

ç«™é»å®Œæˆé ç·©å­˜å¾Œï¼Œservice worker å°‡ç‚ºå¾ŒçºŒè¨ªå•æä¾›ç·©å­˜éŸ¿æ‡‰ã€‚ç•¶æ–°æ§‹å»ºç‰ˆæœ¬èˆ‡æ–° service worker éƒ¨ç½²æ™‚ï¼Œæ–°ç‰ˆæœƒé–‹å§‹å®‰è£ä¸¦æœ€çµ‚é€²å…¥ç­‰å¾…ç‹€æ…‹ã€‚æ­¤æœŸé–“å°‡é¡¯ç¤ºé‡æ–°è¼‰å…¥å½ˆçª—ï¼Œæç¤ºä½¿ç”¨è€…åˆ·æ–°é é¢ä»¥ç²å–æ–°å…§å®¹ã€‚åœ¨ä½¿ç”¨è€…æ¸…é™¤æ‡‰ç”¨ç·©å­˜æˆ–é»æ“Šå½ˆçª—çš„ `reload` æŒ‰éˆ•å‰ï¼Œservice worker æœƒæŒçºŒæä¾›èˆŠç‰ˆå…§å®¹ã€‚

:::warning

é›¢ç·šæ¨¡å¼/é ç·©å­˜éœ€æå‰ä¸‹è¼‰ç«™é»æ‰€æœ‰éœæ…‹è³‡æºï¼Œå¯èƒ½æ¶ˆè€—ä¸å¿…è¦çš„é »å¯¬ã€‚ä¸¦éæ‰€æœ‰é¡å‹ç«™é»éƒ½é©åˆå•Ÿç”¨æ­¤åŠŸèƒ½ã€‚

:::

## é¸é … {#options}

### `debug` {#debug}

- é¡å‹: `boolean`
- é è¨­å€¼: `false`

å•Ÿç”¨é™¤éŒ¯æ¨¡å¼ï¼š

- Workbox æ—¥èªŒ
- é¡å¤–çš„ Docusaurus æ—¥èªŒ
- æœªå„ªåŒ–çš„ SW æª”æ¡ˆè¼¸å‡º
- åŸå§‹ç¢¼æ˜ å°„

### `offlineModeActivationStrategies` {#offlinemodeactivationstrategies}

- é¡å‹: `('appInstalled' | 'mobile' | 'saveData'| 'queryString' | 'always')[]`
- é è¨­å€¼: `['appInstalled', 'queryString', 'standalone']`

å•Ÿç”¨é›¢ç·šæ¨¡å¼çš„ç­–ç•¥ï¼š

- `appInstalled`: é‡å°å·²å°‡ç¶²ç«™å®‰è£ç‚ºæ‡‰ç”¨ç¨‹å¼çš„ä½¿ç”¨è€…å•Ÿç”¨ï¼ˆä¸¦é 100% å¯é ï¼‰
- `standalone`: é‡å°ä»¥ç¨ç«‹æ¨¡å¼åŸ·è¡Œæ‡‰ç”¨ç¨‹å¼çš„ä½¿ç”¨è€…å•Ÿç”¨ï¼ˆé€šå¸¸æ˜¯ PWA å®‰è£å¾Œçš„æƒ…æ³ï¼‰
- `queryString`: è‹¥æŸ¥è©¢å­—ä¸²åŒ…å« `offlineMode=true` å‰‡å•Ÿç”¨ï¼ˆæ–¹ä¾¿ PWA é™¤éŒ¯ï¼‰
- `mobile`: é‡å°è¡Œå‹•è£ç½®ä½¿ç”¨è€…å•Ÿç”¨ï¼ˆ`width <= 996px`ï¼‰
- `saveData`: é‡å° `navigator.connection.saveData === true` çš„ä½¿ç”¨è€…å•Ÿç”¨
- `always`: é‡å°æ‰€æœ‰ä½¿ç”¨è€…å•Ÿç”¨

:::warning

è«‹è¬¹æ…ä½¿ç”¨ï¼šéƒ¨åˆ†ä½¿ç”¨è€…å¯èƒ½ä¸å–œæ­¡è¢«å¼·åˆ¶ä½¿ç”¨é›¢ç·šæ¨¡å¼ã€‚

:::

:::danger

ç›®å‰ç„¡æ³•ä»¥å¯é çš„æ–¹å¼åµæ¸¬é é¢æ˜¯å¦ä»¥ PWA å½¢å¼å‘ˆç¾ã€‚

`appinstalled` äº‹ä»¶å·²[å¾è¦ç¯„ä¸­ç§»é™¤](https://github.com/w3c/manifest/pull/836)ï¼Œä¸” [`navigator.getInstalledRelatedApps()`](https://web.dev/get-installed-related-apps/) API åƒ…åœ¨æœ€æ–°ç‰ˆ Chrome ä¸­æ”¯æ´ï¼Œä¸¦éœ€åœ¨ manifest ä¸­å®£å‘Š `related_applications`ã€‚

[`standalone` ç­–ç•¥](https://petelepage.com/blog/2019/07/is-my-pwa-installed/)æ˜¯å•Ÿç”¨é›¢ç·šæ¨¡å¼çš„ç†æƒ³å‚™ç”¨æ–¹æ¡ˆï¼ˆè‡³å°‘åœ¨åŸ·è¡Œå·²å®‰è£çš„æ‡‰ç”¨ç¨‹å¼æ™‚ï¼‰ã€‚

:::

### `injectManifestConfig` {#injectmanifestconfig}

å‚³éçµ¦ `workbox.injectManifest()` çš„ [Workbox é¸é …](https://developer.chrome.com/docs/workbox/reference/workbox-build/#type-InjectManifestOptions)ã€‚æ­¤é¸é …å¯è®“æ‚¨æ§åˆ¶å“ªäº›è³‡æºæœƒè¢«é å…ˆå¿«å–ï¼Œä¸¦åœ¨é›¢ç·šæ™‚å¯ç”¨ã€‚

- é¡å‹: `InjectManifestOptions`
- é è¨­å€¼: `{}`

```js title="docusaurus.config.js"
export default {
  plugins: [
    [
      '@docusaurus/plugin-pwa',
      {
        injectManifestConfig: {
          manifestTransforms: [
            //...
          ],
          modifyURLPrefix: {
            //...
          },
          // We already add regular static assets (HTML, images...) to be available offline
          // You can add more files according to your needs
          globPatterns: ['**/*.{pdf,docx,xlsx}'],
          // ...
        },
      },
    ],
  ],
};
```

### `pwaHead` {#pwahead}

- é¡å‹: `({ tagName: string; [attributeName: string]: string })[]`
- é è¨­å€¼: `[]`

åŒ…å« `tagName` å’Œå±¬æ€§éµå€¼å°çš„ç‰©ä»¶é™£åˆ—ï¼Œç”¨æ–¼æ³¨å…¥ `<head>` æ¨™ç±¤ã€‚æŠ€è¡“ä¸Šæ‚¨å¯é€éæ­¤æ–¹å¼æ³¨å…¥ä»»ä½• head æ¨™ç±¤ï¼Œä½†ç†æƒ³æƒ…æ³ä¸‹ç”¨æ–¼ä½¿ç¶²ç«™ç¬¦åˆ PWA è¦ç¯„çš„æ¨™ç±¤ã€‚ä»¥ä¸‹æ˜¯ä½¿æ‡‰ç”¨ç¨‹å¼å®Œå…¨åˆè¦çš„æ¨™ç±¤æ¸…å–®ï¼š

```js
export default {
  plugins: [
    [
      '@docusaurus/plugin-pwa',
      {
        pwaHead: [
          {
            tagName: 'link',
            rel: 'icon',
            href: '/img/docusaurus.png',
          },
          {
            tagName: 'link',
            rel: 'manifest',
            href: '/manifest.json',
          },
          {
            tagName: 'meta',
            name: 'theme-color',
            content: 'rgb(37, 194, 160)',
          },
          {
            tagName: 'meta',
            name: 'apple-mobile-web-app-capable',
            content: 'yes',
          },
          {
            tagName: 'meta',
            name: 'apple-mobile-web-app-status-bar-style',
            content: '#000',
          },
          {
            tagName: 'link',
            rel: 'apple-touch-icon',
            href: '/img/docusaurus.png',
          },
          {
            tagName: 'link',
            rel: 'mask-icon',
            href: '/img/docusaurus.svg',
            color: 'rgb(37, 194, 160)',
          },
          {
            tagName: 'meta',
            name: 'msapplication-TileImage',
            content: '/img/docusaurus.png',
          },
          {
            tagName: 'meta',
            name: 'msapplication-TileColor',
            content: '#000',
          },
        ],
      },
    ],
  ],
};
```

### `swCustom` {#swcustom}

- é¡å‹: `string | undefined`
- é è¨­å€¼: `undefined`

é©ç”¨æ–¼é¡å¤–çš„ Workbox è¦å‰‡ã€‚æ‚¨å¯åœ¨æ­¤åŸ·è¡Œä»»ä½• service worker èƒ½å¯¦ç¾çš„åŠŸèƒ½ï¼Œä¸¦å……åˆ†é‹ç”¨ workbox å‡½å¼åº«çš„èƒ½åŠ›ã€‚ç¨‹å¼ç¢¼æœƒç¶“éè½‰è­¯ï¼Œå› æ­¤å¯ä½¿ç”¨ç¾ä»£ ES6+ èªæ³•ã€‚

ä¾‹å¦‚ï¼Œå¿«å–å¤–éƒ¨è·¯ç”±çš„æª”æ¡ˆï¼š

```js
import {registerRoute} from 'workbox-routing';
import {StaleWhileRevalidate} from 'workbox-strategies';

// default fn export receiving some useful params
export default function swCustom(params) {
  const {
    debug, // :boolean
    offlineMode, // :boolean
  } = params;

  // Cache responses from external resources
  registerRoute((context) => {
    return [
      /graph\.facebook\.com\/.*\/picture/,
      /netlify\.com\/img/,
      /avatars1\.githubusercontent/,
    ].some((regex) => context.url.href.match(regex));
  }, new StaleWhileRevalidate());
}
```

æ¨¡çµ„æ‡‰å…·æœ‰ `default` å‡½å¼åŒ¯å‡ºï¼Œä¸¦æ¥æ”¶éƒ¨åˆ†åƒæ•¸ã€‚

### `swRegister` {#swregister}

- é¡å‹: `string | false`
- é è¨­å€¼: `'docusaurus-plugin-pwa/src/registerSW.js'`

åœ¨ Docusaurus æ‡‰ç”¨ç¨‹å¼å‰æ–°å¢ä¸€å€‹é€²å…¥é»ï¼Œä»¥ä¾¿åœ¨æ‡‰ç”¨ç¨‹å¼åŸ·è¡Œå‰å®Œæˆè¨»å†Šã€‚é è¨­çš„ `registerSW.js` æª”æ¡ˆå·²è¶³å¤ æ‡‰ä»˜ç°¡å–®çš„è¨»å†Šéœ€æ±‚ã€‚

å‚³é `false` å°‡å®Œå…¨åœç”¨è¨»å†ŠåŠŸèƒ½ã€‚

## Manifest ç¯„ä¾‹ {#manifest-example}

Docusaurus ç¶²ç«™çš„ manifest æª”æ¡ˆå¯ä½œç‚ºåƒè€ƒç¯„æœ¬ï¼š

```mdx-code-block
import CodeBlock from '@theme/CodeBlock';

<CodeBlock className="language-json">
  {JSON.stringify(require('@site/static/manifest.json'),null,2)}
</CodeBlock>
```

## è‡ªè¨‚é‡æ–°è¼‰å…¥å½ˆå‡ºè¦–çª— {#customizing-reload-popup}

ç•¶æ–°çš„ service worker ç­‰å¾…å®‰è£æ™‚ï¼Œæœƒæ¸²æŸ“ `@theme/PwaReloadPopup` å…ƒä»¶ä¸¦å‘ä½¿ç”¨è€…å»ºè­°é‡æ–°è¼‰å…¥ã€‚æ‚¨å¯ä»¥[æ›¿æ›](../../swizzling.mdx)æ­¤å…ƒä»¶ä¸¦å¯¦ä½œè‡ªå·±çš„ UIã€‚è©²å…ƒä»¶æœƒæ¥æ”¶ `onReload` å›èª¿å‡½å¼ä½œç‚º propsï¼Œæ‡‰åœ¨ä½¿ç”¨è€…é»æ“Šã€Œé‡æ–°è¼‰å…¥ã€æŒ‰éˆ•æ™‚å‘¼å«æ­¤å‡½å¼ï¼Œé€™å°‡æŒ‡ç¤º service worker å®‰è£ç­‰å¾…ä¸­çš„ç‰ˆæœ¬ä¸¦é‡æ–°è¼‰å…¥é é¢ã€‚

é è¨­ä¸»é¡ŒåŒ…å«é‡æ–°è¼‰å…¥å½ˆå‡ºè¦–çª—çš„å¯¦ä½œï¼Œä¸¦ä½¿ç”¨ [Infima è­¦ç¤ºæ¡†](https://infima.dev/docs/components/alert)ã€‚

![é‡æ–°è¼‰å…¥æµç¨‹çš„è¢å¹•éŒ„å½±ç•«é¢ã€‚è¦–çª—å³ä¸‹è§’é¡¯ç¤ºè­¦ç¤ºæ¡†ï¼Œå…§å®¹ç‚ºã€Œæœ‰æ–°å…§å®¹å¯ç”¨ã€ã€‚é»æ“Šã€Œé‡æ–°æ•´ç†ã€æŒ‰éˆ•å¾Œï¼Œé é¢ä¸»æ¨™é¡Œå¾ã€Œç°¡ä»‹ã€è®Šæ›´ç‚ºã€ŒPWA :))ã€ã€‚](/img/pwa_reload.gif)

æ‚¨çš„å…ƒä»¶å¯ä»¥æ¸²æŸ“ `null`ï¼Œä½†ä¸å»ºè­°é€™éº¼åšï¼šä½¿ç”¨è€…å°‡ç„¡æ³•å–å¾—æœ€æ–°å…§å®¹ã€‚