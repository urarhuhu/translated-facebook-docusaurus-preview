---
slug: /versioning
---

# 版本控制

您可以使用版本控制CLI工具，基於`docs`目錄中的最新內容創建新的文檔版本。該特定版本的文檔將被保留並可訪問，即使`docs`目錄中的文檔持續演進。

```mdx-code-block
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
```

:::warning

在開始對文檔進行版本控制前請慎重考慮——這可能會使貢獻者難以協助改進文檔！

:::

大多數情況下，您不需要版本控制，因為這只會增加構建時間並為代碼庫引入複雜性。版本控制**最適合文檔版本間變化快速且流量高的網站**。如果您的文檔很少變更，請勿為文檔添加版本控制。

要更好地理解版本控制的工作原理並判斷是否符合您的需求，請繼續閱讀以下內容。

## 概述 {#overview}

典型的版本化文檔站點結構如下：

```bash
website
├── sidebars.json        # sidebar for the current docs version
├── docs                 # docs directory for the current docs version
│   ├── foo
│   │   └── bar.md       # https://mysite.com/docs/next/foo/bar
│   └── hello.md         # https://mysite.com/docs/next/hello
├── versions.json        # file to indicate what versions are available
├── versioned_docs
│   ├── version-1.1.0
│   │   ├── foo
│   │   │   └── bar.md   # https://mysite.com/docs/foo/bar
│   │   └── hello.md
│   └── version-1.0.0
│       ├── foo
│       │   └── bar.md   # https://mysite.com/docs/1.0.0/foo/bar
│       └── hello.md
├── versioned_sidebars
│   ├── version-1.1.0-sidebars.json
│   └── version-1.0.0-sidebars.json
├── docusaurus.config.js
└── package.json
```

`versions.json`文件是按從新到舊排序的版本名稱列表。

下表說明版本化文件如何映射到其版本及生成的URL。

| Path                                    | Version        | URL               |
| --------------------------------------- | -------------- | ----------------- |
| `versioned_docs/version-1.0.0/hello.md` | 1.0.0          | /docs/1.0.0/hello |
| `versioned_docs/version-1.1.0/hello.md` | 1.1.0 (latest) | /docs/hello       |
| `docs/hello.md`                         | current        | /docs/next/hello  |

:::tip

`docs`目錄中的文件屬於`current`文檔版本。

默認情況下，`current`文檔版本標記為`Next`並托管在`/docs/next/*`下，但可完全配置以適應項目的發布週期。

:::

### 術語說明 {#terminology}

請注意此處使用的術語。

<dl>
  <dt>
    <b>Current version</b>
  </dt>
  <dd>
    {'The version placed in the '}
    <code>./docs</code>
    {' folder.'}
  </dd>
  <dt>
    <b>Latest version / last version</b>
  </dt>
  <dd>
    {'The version served by default for docs navbar items. Usually has path '}
    <code>/docs</code>
    {'.'}
  </dd>
</dl>

當前版本由**文件系統位置**定義，而最新版本由**導航行為**定義。它們可能是也可能不是同一個版本！（如上表所示的默認配置會將它們視為不同：當前版本在`/docs/next`，最新版本在`/docs`。）

## 教程 {#tutorials}

### 標記新版本 {#tagging-a-new-version}

1. 首先，確保當前文檔版本（`./docs`目錄）已準備好被凍結。
2. 輸入新版本號。

```bash npm2yarn
npm run docusaurus docs:version 1.1.0
```

標記新版本時，文檔版本控制機制將：

- 將完整的`docs/`目錄內容複製到新的`versioned_docs/version-[versionName]/`目錄中。
- 根據當前[側邊欄](./sidebar/index.mdx)配置（如果存在）創建版本化側邊欄文件——保存為`versioned_sidebars/version-[versionName]-sidebars.json`。
- 將新版本號追加到`versions.json`中。

### 創建新文檔 {#creating-new-docs}

1. 將新文件放入對應版本的目錄中。
2. 根據版本號在對應的側邊欄文件中添加新文件的引用。

```mdx-code-block
<Tabs>
<TabItem value="Current version structure">
```

```bash
# The new file.
docs/new.md

# Edit the corresponding sidebar file.
sidebars.js
```

```mdx-code-block
</TabItem>
<TabItem value="Older version structure">
```

```bash
# The new file.
versioned_docs/version-1.0.0/new.md

# Edit the corresponding sidebar file.
versioned_sidebars/version-1.0.0-sidebars.json
```

```mdx-code-block
</TabItem>
</Tabs>
```

:::tip

版本化側邊欄文件與標準側邊欄文件一樣，是相對於給定版本的內容根目錄——因此對於上面的示例，您的版本化側邊欄文件可能如下：

```json
{
  "sidebar": [
    {
      "type": "autogenerated",
      "dirName": "."
    }
  ]
}
```

或對於手動側邊欄：

```json
{
  "sidebar": [
    {
      "type": "doc",
      "id": "new",
      "label": "New"
    }
  ]
}
```

:::

### 更新現有版本 {#updating-an-existing-version}

您可以同時更新多個文件版本，因為 `versioned_docs/` 中的每個目錄在發布時都代表特定的路由。

1. 編輯任何文件。
2. 提交並推送變更。
3. 它將被發布到該版本。

範例：當您變更 `versioned_docs/version-2.6/` 中的任何文件時，只會影響版本 `2.6` 的文件。

### 刪除現有版本 {#deleting-an-existing-version}

您也可以刪除/移除版本。

1. 從 `versions.json` 中移除該版本。

範例：

```diff
[
  "2.0.0",
  "1.9.0",
  // highlight-next-line
- "1.8.0"
]
```

2. 刪除版本化文件目錄。範例：`versioned_docs/version-1.8.0`。
3. 刪除版本化側邊欄文件。範例：`versioned_sidebars/version-1.8.0-sidebars.json`。

## 配置版本化行為 {#configuring-versioning-behavior}

「當前」版本是 `./docs` 文件夾的版本名稱。管理版本化有不同方式，但兩種非常常見的模式是：

- 您發布了 v1，並立即開始開發 v2（包括其文件）。在這種情況下，**當前版本**是 v2，位於 `./docs` 源文件夾中，可以在 `example.com/docs/next` 瀏覽。**最新版本**是 v1，位於 `./versioned_docs/version-1` 源文件夾中，大多數用戶在 `example.com/docs` 瀏覽。
- 您發布了 v1，並將維護一段時間才會考慮 v2。在這種情況下，**當前版本**和**最新版本**都指向 v1，因為 v2 文件甚至還不存在！

Docusaurus 的預設值非常適合第一種使用情境。我們會將當前版本標記為「next」，您甚至可以選擇不發布它。

**對於第二種使用情境**：如果您發布了 v1 且不計劃短期內開發 v2，與其版本化 v1 並必須維護兩個文件夾（`./docs` + `./versioned_docs/version-1.0.0`），您可以考慮「假裝」當前版本是一個已切割的版本，通過給予它一個路徑和標籤：

```js title="docusaurus.config.js"
export default {
  presets: [
    '@docusaurus/preset-classic',
    docs: {
      // highlight-start
      lastVersion: 'current',
      versions: {
        current: {
          label: '1.0.0',
          path: '1.0.0',
        },
      },
      // highlight-end
    },
  ],
};
```

`./docs` 中的文件將在 `/docs/1.0.0` 提供，而不是 `/docs/next`，且 `1.0.0` 將成為我們在導覽列下拉選單中連結的預設版本，您只需維護單一的 `./docs` 文件夾。

我們提供這些插件選項來客製化版本化行為：

- `disableVersioning`: 明確停用版本控制，即使存在多個版本。這將使網站僅包含當前版本。
- `includeCurrentVersion`: 包含當前版本（`./docs` 資料夾）的文件。
  - **提示**：若當前版本尚在開發中且未準備好發布，可將其關閉。
- `lastVersion`: 設定「最新版本」（`/docs` 路由）所指向的版本。
  - **提示**：若當前版本為持續修補和發布的主要版本，`lastVersion: 'current'` 是合理的設定。最新版本的實際路由基礎路徑和標籤可另行配置。
- `onlyIncludeVersions`: 定義從 `versions.json` 中部署的版本子集。
  - **提示**：在開發和部署預覽中限制為 2 或 3 個版本，以提升啟動和建置速度。
- `versions`: 版本元數據的字典。每個版本可自訂以下項目：
  - `label`: 在版本下拉選單和橫幅中顯示的標籤。
  - `path`: 此版本的基礎路由路徑。預設情況下，最新版本為 `/`，當前版本為 `/next`。
  - `banner`: 可設為 `'none'`、`'unreleased'` 或 `'unmaintained'`。決定每個文件頁面頂部顯示的內容。任何高於最新版本的版本會標記為「未發布」，低於的則標記為「未維護」。
  - `badge`: 在該版本的文件頂部顯示版本名稱的徽章。
  - `className`: 為該版本的文件頁面 `<html>` 元素添加自訂 `className`。

詳見 [文件插件配置](../../api/plugins/plugin-content-docs.mdx#configuration)。

## 導航欄項目 {#navbar-items}

我們提供多種文件導航欄項目，協助您快速設定導航，無需擔心版本化路由問題。

- [`doc`](../../api/themes/theme-configuration.mdx#navbar-doc-link): 指向單一文件的連結。
- [`docSidebar`](../../api/themes/theme-configuration.mdx#navbar-doc-sidebar): 指向側邊欄首個項目的連結。
- [`docsVersion`](../../api/themes/theme-configuration.mdx#navbar-docs-version): 指向當前瀏覽版本主文件的連結。
- [`docsVersionDropdown`](../../api/themes/theme-configuration.mdx#navbar-docs-version-dropdown): 包含所有可用版本的下拉選單。

這些連結會依以下順序尋找合適的版本進行指向：

1. **當前版本**：若使用者正在瀏覽該文件插件提供的頁面，則為其當前瀏覽的版本。若非文件頁面，則退回至...
2. **偏好版本**：使用者最後瀏覽的版本。若無歷史記錄，則退回至...
3. **最新版本**：預設導向的版本，由 `lastVersion` 選項配置。

## `docsVersionDropdown` {#docsVersionDropdown}

預設情況下，[`docsVersionDropdown`](../../api/themes/theme-configuration.mdx#navbar-docs-version-dropdown) 會顯示包含所有可用文件版本的下拉選單。

`versions` 屬性允許您以指定順序顯示可用版本的子集：

```js title="docusaurus.config.js"
export default {
  themeConfig: {
    navbar: {
      items: [
        {
          type: 'docsVersionDropdown',
          // highlight-start
          versions: ['current', '3.0', '2.0'],
          // highlight-end
        },
      ],
    },
  },
};
```

傳遞 `versions` 物件可覆蓋每個版本的顯示標籤：

```js title="docusaurus.config.js"
export default {
  themeConfig: {
    navbar: {
      items: [
        {
          type: 'docsVersionDropdown',
          // highlight-start
          versions: {
            current: {label: 'Version 4.0'},
            '3.0': {label: 'Version 3.0'},
            '2.0': {label: 'Version 2.0'},
          },
          // highlight-end
        },
      ],
    },
  },
};
```

## 推薦實踐 {#recommended-practices}

### 僅在需要時為文件建立版本 {#version-your-documentation-only-when-needed}

例如，您正在為 npm 套件 `foo` 建置文件，當前版本為 1.0.0。隨後您發布了一個修補版本以修正小錯誤，版本變為 1.0.1。

您應該為此建立新的文件版本 1.0.1 嗎？**可能不需要**。根據語意化版本規範，1.0.1 和 1.0.0 的文件不應有差異（因為沒有新增功能！）。為此建立新版本只會產生不必要的重複檔案。

### 保持版本數量精簡 {#keep-the-number-of-versions-small}

作為良好實踐，建議將版本數量控制在10個以下。您很可能會累積大量無人閱讀的過時版本文件。例如 [Jest](https://jestjs.io/versions) 目前版本為 `27.4`，但僅維護幾個最新版本文件（最低版本為 `25.X`）。保持精簡 😊

:::tip[封存舊版本]

若您將網站部署在 Jamstack 供應商（如 [Netlify](../../deployment.mdx)），供應商會將每次生產環境建構保存為不可變更的網址快照。您可以將不再重建的封存版本設為指向這些永久網址的外部連結。Jest 官網和 Docusaurus 官網皆採用此模式來降低需主動建構的版本數量。

:::

### 在文件中使用絕對路徑導入 {#use-absolute-import-within-the-docs}

請勿在文件中使用相對路徑導入。因為當我們建立新版本時，這些路徑會失效（嵌套層級改變等因素）。您可以使用 Docusaurus 提供的 `@site` 別名（指向 `website` 目錄）。範例：

```diff
- import Foo from '../src/components/Foo';
+ import Foo from '@site/src/components/Foo';
```

### 透過文件路徑連結 {#link-docs-by-file-paths}

引用其他文件時請使用帶有 `.md` 副檔名的相對文件路徑，這樣 Docusaurus 才能在建構時將其重寫為實際 URL 路徑。文件將正確連結至對應版本。

```md
The [@hello](hello.mdx#paginate) document is great!

See the [Tutorial](../getting-started/tutorial.mdx) for more info.
```

### 全域或版本化共置資源 {#global-or-versioned-collocated-assets}

您需要決定資源（如圖片和文件）是屬於特定版本或跨版本共用。

若資源需版本化，請將其置於文件版本目錄中，並使用相對路徑：

```md
![img alt](./myImage.png)

[download this file](./file.pdf)
```

若資源為全域性，請將其置於 `/static` 目錄並使用絕對路徑：

```md
![img alt](/myImage.png)

[download this file](/file.pdf)
```